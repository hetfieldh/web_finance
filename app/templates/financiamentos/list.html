<!--- app\templates\financiamentos\list.html -->

{% extends "base.html" %} {% from "includes/_macros.html" import
render_confirm_modal %} {% block content %}
<div class="row">
  <div class="col-12">
    <div
      class="caixa-sombreada-cinza p-2 d-flex flex-column flex-md-row justify-content-between align-items-center mb-2 gap-2"
    >
      <h5
        class="mb-0 me-2 d-flex align-items-center"
        style="color: var(--wf-azul-destaque)"
      >
        <i class="fab px-2 fa-innosoft fa-lg text-warning"></i>
        Movimentações de Financiamento
      </h5>
      <div class="d-flex w-md-auto justify-content-end">
        <a
          href="{{ url_for('financiamento.adicionar_financiamento') }}"
          class="btn btn-azul btn-sm flex-grow-1 flex-md-grow-0"
        >
          <i class="fas fa-plus text-warning me-1"></i> Financiamento
        </a>
      </div>
    </div>

    <div>
      <div>
        {% if financiamentos %}

        <div class="table-responsive p-0 d-none d-lg-block">
          <div class="card">
            <div class="card-body">
              <table class="table table-striped table-hover sortable-table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Nome</th>
                    <th>Conta</th>
                    <th>Valor Financiado</th>
                    <th>Saldo Devedor</th>
                    <th>Prazo (Meses)</th>
                    <th>Amortização</th>
                    <th>Data Início</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody>
                  {% for financiamento in financiamentos %}
                  <tr>
                    <td>{{ financiamento.id }}</td>
                    <td>{{ financiamento.nome_financiamento }}</td>
                    <td>{{ financiamento.conta.nome_banco }}</td>
                    <td>
                      {{ financiamento.valor_total_financiado | format_currency
                      }}
                    </td>
                    <td class="fw-bold text-danger">
                      {{ financiamento.saldo_devedor_atual | format_currency }}
                    </td>
                    <td>{{ financiamento.prazo_meses }}</td>
                    <td>{{ financiamento.tipo_amortizacao }}</td>
                    <td>
                      {{ financiamento.data_inicio.strftime('%d/%m/%Y') }}
                    </td>
                    <td class="table-actions">
                      <a
                        href="{{ url_for('financiamento.visualizar_parcelas', id=financiamento.id) }}"
                        class="btn btn-secondary me-1"
                        title="Visualizar Parcelas"
                      >
                        <i class="fas fa-list-ol"></i>
                      </a>
                      <a
                        href="{{ url_for('financiamento.amortizar_financiamento', id=financiamento.id) }}"
                        class="btn btn-primary me-1"
                        title="Amortizar Parcelas"
                      >
                        <i class="fas fa-dollar-sign"></i>
                      </a>
                      <a
                        href="{{ url_for('financiamento.editar_financiamento', id=financiamento.id) }}"
                        class="btn btn-warning me-1"
                        title="Editar"
                      >
                        <i class="fas fa-edit"></i>
                      </a>
                      <button
                        type="button"
                        class="btn btn-danger"
                        data-bs-toggle="modal"
                        data-bs-target="#confirmDeleteModal"
                        data-form-action="{{ url_for('financiamento.excluir_financiamento', id=financiamento.id) }}"
                        title="Excluir"
                      >
                        <i class="fas fa-trash-alt"></i>
                      </button>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="d-lg-none">
          {% for financiamento in financiamentos %}
          <div class="card mb-3 border-start border-1 border-primary">
            <div class="card-body p-2">
              <div
                class="d-flex justify-content-between align-items-start mb-2"
              >
                <div>
                  <h5 class="card-title fw-bold mb-0 text-primary">
                    {{ financiamento.nome_financiamento }}
                  </h5>
                  <div class="small text-muted">
                    <i class="fas fa-university me-1"></i>{{
                    financiamento.conta.nome_banco }}
                  </div>
                </div>
                <span class="badge bg-light text-dark border"
                  >{{ financiamento.tipo_amortizacao }}</span
                >
              </div>

              <div class="bg-light p-2 rounded mb-3 border">
                <div class="row g-2 text-center">
                  <div class="col-6 border-end">
                    <div class="extra-small text-muted text-uppercase">
                      Financiado
                    </div>
                    <div class="fw-medium text-dark">
                      {{ financiamento.valor_total_financiado | format_currency
                      }}
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="extra-small text-muted text-uppercase">
                      Saldo Devedor
                    </div>
                    <div class="fw-bold text-danger">
                      {{ financiamento.saldo_devedor_atual | format_currency }}
                    </div>
                  </div>
                </div>
              </div>

              <div
                class="d-flex justify-content-between align-items-center mb-3 small text-muted px-1"
              >
                <span
                  ><i class="far fa-calendar-alt me-1"></i> Início: {{
                  financiamento.data_inicio.strftime('%d/%m/%y') }}</span
                >
                <span
                  ><i class="fas fa-clock me-1"></i> Prazo:
                  <strong>{{ financiamento.prazo_meses }}x</strong></span
                >
              </div>

              <div class="row g-2">
                <div class="col-6">
                  <a
                    href="{{ url_for('financiamento.visualizar_parcelas', id=financiamento.id) }}"
                    class="btn btn-outline-secondary btn-sm w-100 d-flex align-items-center justify-content-center"
                  >
                    <i class="fas fa-list-ol me-2"></i> Parcelas
                  </a>
                </div>
                <div class="col-6">
                  <a
                    href="{{ url_for('financiamento.amortizar_financiamento', id=financiamento.id) }}"
                    class="btn btn-outline-primary btn-sm w-100 d-flex align-items-center justify-content-center"
                  >
                    <i class="fas fa-dollar-sign me-2"></i> Amortizar
                  </a>
                </div>
                <div class="col-6">
                  <a
                    href="{{ url_for('financiamento.editar_financiamento', id=financiamento.id) }}"
                    class="btn btn-outline-warning btn-sm w-100 d-flex align-items-center justify-content-center"
                  >
                    <i class="fas fa-edit me-2"></i> Editar
                  </a>
                </div>
                <div class="col-6">
                  <button
                    type="button"
                    class="btn btn-outline-danger btn-sm w-100 d-flex align-items-center justify-content-center"
                    data-bs-toggle="modal"
                    data-bs-target="#confirmDeleteModal"
                    data-form-action="{{ url_for('financiamento.excluir_financiamento', id=financiamento.id) }}"
                  >
                    <i class="fas fa-trash-alt me-2"></i> Excluir
                  </button>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>

        {% else %}
        <div class="card border-1">
          <div class="card-body text-center py-3">
            <i
              class="fas fa-hand-holding-usd fa-3x text-muted mb-3 opacity-50"
            ></i>
            <p class="text-center text-muted mb-0">
              Nenhum financiamento cadastrado ainda.
            </p>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{{ render_confirm_modal( modal_id='confirmDeleteModal', title='Confirmar
Exclusão', body_text='Tem certeza que deseja excluir este registro? Esta ação
não pode ser desfeita.', confirm_button_text='Sim, Excluir' ) }} {% endblock %}
