<!-- app/templates/financiamentos/parcelas.html -->

{% extends "base.html" %} {% block title %}Web Finance - Financiamentos{%
endblock %} {% block page_title %}Parcelas de {{
financiamento.nome_financiamento }}{% endblock %} {% block content %}
<div class="row">
  <div class="col-12">
    <div class="d-flex justify-content-end mb-3">
      <a
        href="{{ url_for('financiamento.listar_financiamentos') }}"
        class="btn btn-secondary btn-add"
      >
        <i class="fas fa-arrow-left"></i> Voltar
      </a>
    </div>

    <div class="card shadow-sm">
      <div class="card-header bg-dark text-white">
        <h5 class="mb-0">Tabela de Amortização</h5>
      </div>
      <div class="card-body">
        {% if parcelas_data %}
        <div class="table-responsive">
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th class="text-center">#</th>
                <th class="text-center">Vencimento</th>
                <th class="text-center">Amortização</th>
                <th class="text-center">Juros</th>
                <th class="text-center">Seguros</th>
                <th class="text-center">Taxas</th>
                <th class="text-center">Total Previsto</th>
                <th class="text-center">Valor Pago</th>
                <th class="text-center">Saldo Devedor</th>
                <th class="text-center">Status</th>
                <th class="text-center">Data Pagamento</th>
                <th class="text-left">Obs.</th>
              </tr>
            </thead>
            <tbody>
              {% for item in parcelas_data %}
              <tr>
                <td class="text-center">{{ item.parcela.numero_parcela }}</td>
                <td class="text-center">{{ item.parcela.data_vencimento.strftime('%d/%m/%Y') }}</td>
                <td class="text-center">{{ item.parcela.valor_principal | format_currency }}</td>
                <td class="text-center">{{ item.parcela.valor_juros | format_currency }}</td>
                <td class="text-center">
                  {{ (item.parcela.valor_seguro + item.parcela.valor_seguro_2 +
                  item.parcela.valor_seguro_3) | format_currency }}
                </td>
                <td class="text-center">{{ item.parcela.valor_taxas | format_currency }}</td>
                <td class="fw-bold text-center">
                  {{ item.parcela.valor_total_previsto | format_currency }}
                </td>
                <td class="fw-bold text-success text-center">
                  {% if item.parcela.valor_pago %} {{ item.parcela.valor_pago |
                  format_currency }} {% else %} - {% endif %}
                </td>
                <td
                  class="fw-bold text-center {{ 'text-secondary' if item.parcela.status in ['Paga', 'Amortizada'] else 'text-danger' }}"
                >
                  {{ "-" | format_currency if item.parcela.status in ['Paga',
                  'Amortizada'] else item.saldo_devedor_futuro | format_currency
                  }}
                </td>
                <td class= text-center>
                  {% if item.parcela.status == 'Paga' %}<span
                    class="badge bg-success"
                    >{{ item.parcela.status }}</span
                  >
                  {% elif item.parcela.status == 'Atrasada' %}<span
                    class="badge bg-danger"
                    >{{ item.parcela.status }}</span
                  >
                  {% elif item.parcela.status == 'Amortizada' %}<span
                    class="badge bg-info"
                    >{{ item.parcela.status }}</span
                  >
                  {% else %}<span class="badge bg-secondary"
                    >{{ item.parcela.status }}</span
                  >
                  {% endif %}
                </td>
                <td class="text-center">
                  {{ item.parcela.data_pagamento.strftime('%d/%m/%Y') if
                  item.parcela.data_pagamento else 'N/A' }}
                </td>
                <td class="text-left">
                  {{ item.parcela.observacoes if item.parcela.observacoes else
                  '' }}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="alert alert-warning text-center">
          Nenhuma parcela encontrada.
          <a
            href="{{ url_for('financiamento.importar_parcelas', id=financiamento.id) }}"
            class="alert-link"
            >Clique aqui para importá-las</a
          >.
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
