<!--- app\templates\financiamentos\amortizar.html -->

{% extends "base.html" %} {% from "includes/_macros.html" import render_field %}
{% block title %}Amortizar Financiamento{% endblock %} {% block page_title
%}Amortizar Financiamento: {{ financiamento.nome_financiamento }}{% endblock %}
{% block content %}
<form
  id="form-amortizacao"
  method="POST"
  action="{{ url_for('financiamento.amortizar_financiamento', id=financiamento.id) }}"
>
  {{ form.csrf_token }}
  <div class="row">
    <div class="col-lg-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Detalhes da Amortização</h5>
          <div class="mb-3">
            {{ render_field(form.valor_amortizacao, attrs={'type': 'number',
            'step': '0.01', 'id': 'valor_amortizacao'}) }}
          </div>
          <div class="mb-3">{{ render_field(form.conta_id) }}</div>
          <div class="mb-3">
            {{ render_field(form.data_pagamento, attrs={'type': 'date'}) }}
          </div>
          <hr />
          <div id="resumo-amortizacao" class="alert alert-info">
            <strong>Resumo da Operação:</strong><br />
            <small
              >Total a Amortizar: <span id="resumo-valor">R$ 0,00</span></small
            ><br />
            <small
              >Parcelas Selecionadas: <span id="resumo-parcelas">0</span></small
            ><br />
            <small
              >Valor por Parcela:
              <span id="resumo-valor-parcela">R$ 0,00</span></small
            >
          </div>

          <div class="d-flex justify-content-center gap-2">
            <button type="submit" class="btn btn-success btn-add">
              <i class="fas fa-hand-holding-usd me-1"></i> {{
              form.submit.label.text }}
            </button>
            <a
              href="{{ url_for('financiamento.listar_financiamentos') }}"
              class="btn btn-secondary btn-add"
            >
              <i class="fas fa-arrow-left me-1"></i> Voltar
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-5">
      <div class="card shadow-sm">
        <div class="card-header">Selecione as parcelas</div>
        <div class="card-body" style="max-height: 450px; overflow-y: auto">
          <table class="table table-sm table-hover">
            <thead>
              <tr>
                <th>Sel.</th>
                <th class="text-center">#</th>
                <th class="text-end">Vencimento</th>
                <th class="text-end">Valor Principal</th>
                <th class="text-end">Valor Parcela no Vencimento</th>
              </tr>
            </thead>
            <tbody>
              {% for parcela in parcelas %}
              <tr>
                <td>
                  <input
                    type="checkbox"
                    name="parcelas_selecionadas"
                    value="{{ parcela.id }}"
                    class="form-check-input parcela-checkbox"
                    data-valor="{{ parcela.valor_principal }}"
                  />
                </td>
                <td class="text-center fw-bold text-danger">
                  {{ parcela.numero_parcela }}
                </td>
                <td class="text-end">
                  {{ parcela.data_vencimento.strftime('%d/%m/%Y') }}
                </td>
                <td class="text-end fw-bold text-success">
                  R$ {{ "%.2f"|format(parcela.valor_principal) }}
                </td>
                <td class="text-end">
                  R$ {{ "%.2f"|format(parcela.valor_total_previsto) }}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</form>
{% endblock %} {% block scripts %}
<script src="{{ url_for('static', filename='js/forms.js') }}"></script>
{% endblock %}
