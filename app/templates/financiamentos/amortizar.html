<!--- app\templates\financiamentos\amortizar.html -->

{% extends "base.html" %} {% from "includes/_macros.html" import render_field %}
{% block title %}Amortizar Financiamento{% endblock %} {% block page_title
%}Amortizar Financiamento: {{ financiamento.nome_financiamento }}{% endblock %}
{% block content %}
<form
  id="form-amortizacao"
  method="POST"
  action="{{ url_for('financiamento.amortizar_financiamento', id=financiamento.id) }}"
>
  {{ form.csrf_token }}
  <div class="row">
    <!-- Coluna Esquerda: Formulário -->
    <div class="col-lg-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Detalhes da Amortização</h5>
          <div class="mb-3">
            {{ render_field(form.valor_amortizacao, attrs={'type': 'number',
            'step': '0.01', 'id': 'valor_amortizacao'}) }}
          </div>
          <div class="mb-3">{{ render_field(form.conta_id) }}</div>
          <div class="mb-3">
            {{ render_field(form.data_pagamento, attrs={'type': 'date'}) }}
          </div>
          <hr />
          <div id="resumo-amortizacao" class="alert alert-info">
            <strong>Resumo da Operação:</strong><br />
            <small
              >Total a Amortizar: <span id="resumo-valor">R$ 0,00</span></small
            ><br />
            <small
              >Parcelas Selecionadas: <span id="resumo-parcelas">0</span></small
            ><br />
            <small
              >Valor por Parcela:
              <span id="resumo-valor-parcela">R$ 0,00</span></small
            >
          </div>
          {{ form.submit(class="btn btn-success w-100") }}
        </div>
      </div>
    </div>

    <!-- Coluna Direita: Lista de Parcelas -->
    <div class="col-lg-8">
      <div class="card shadow-sm">
        <div class="card-header">
          Selecione as parcelas a serem amortizadas (da última para a primeira)
        </div>
        <div class="card-body" style="max-height: 500px; overflow-y: auto">
          <table class="table table-sm table-hover">
            <thead>
              <tr>
                <th>Sel.</th>
                <th>#</th>
                <th>Vencimento</th>
                <th class="text-end">Valor Principal</th>
              </tr>
            </thead>
            <tbody>
              {% for parcela in parcelas %}
              <tr>
                <td>
                  <input
                    type="checkbox"
                    name="parcelas_selecionadas"
                    value="{{ parcela.id }}"
                    class="form-check-input parcela-checkbox"
                    data-valor="{{ parcela.valor_principal }}"
                  />
                </td>
                <td>{{ parcela.numero_parcela }}</td>
                <td>{{ parcela.data_vencimento.strftime('%d/%m/%Y') }}</td>
                <td class="text-end">
                  R$ {{ "%.2f"|format(parcela.valor_principal) }}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</form>
{% endblock %} {% block scripts %} {% endblock %}
