<!--- app\templates\financiamentos\amortizar.html -->

{% extends "base.html" %} {% from "includes/_macros.html" import render_field %}
{% block content %}
<form
  id="form-amortizacao"
  method="POST"
  action="{{ url_for('financiamento.amortizar_financiamento', id=financiamento.id) }}"
  data-saldo-devedor-atual="{{ financiamento.saldo_devedor_atual }}"
>
  {{ form.csrf_token }}
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow-sm">
        <div class="card-header menu-primario">
          <h5 class="mb-0">
            <i class="fas fa-calculator text-warning me-2"></i>Amortização de Financiamento
          </h5>
        </div>
        <div class="card-body">
          <h6
            class="caixa-sombreada"
          >
            1. Detalhes do Pagamento
          </h6>

          <div class="row g-2 mb-2 align-items-end">
            <div class="col-12 col-md-3">
              {{ render_field(form.valor_amortizacao, attrs={ 'type': 'number',
              'step': '0.01', 'id': 'valor_amortizacao', 'autocomplete': 'off',
              'class': 'form-control' }) }}
            </div>

            <div class="col-12 col-md-3">
              {{ render_field(form.data_pagamento, attrs={'type': 'date',
              'class': 'form-control'}) }}
            </div>

            <div class="col-12 col-md-6">
              {{ render_field(form.conta_id, attrs={'class': 'form-control'}) }}
            </div>
          </div>

          <hr class="my-2" />

          <h6
            class="caixa-sombreada"
          >
            2. Forma de Amortização
          </h6>

          <div class="mb-3">
            {{ render_field(form.estrategia, attrs={'id': 'estrategia_selecao'})
            }}
          </div>

          <hr class="my-2" />

          <h6
            class="caixa-sombreada"
          >
            3. Resumo da Operação
          </h6>

          <div id="resumo-amortizacao" class="bg-light p-3 rounded">
            <div class="d-flex justify-content-between">
              <span class="text-muted">Total a Amortizar:</span>
              <span id="resumo-valor" class="fw-bold text-dark">R$ 0,00</span>
            </div>
            <div class="d-flex justify-content-between mt-2">
              <span class="text-muted">Saldo Devedor (Depois):</span>
              <span id="resumo-saldo-depois" class="fw-bold text-danger"
                >R$ 0,00</span
              >
            </div>
            <hr class="my-2" />

            <div id="resumo-prazo">
              <div class="d-flex justify-content-between mt-2">
                <span class="text-muted">Parcelas Quitadas:</span>
                <span
                  id="resumo-parcelas-quitadas-lista"
                  class="fw-bold text-success"
                  >Nenhuma</span
                >
              </div>
              <div class="d-flex justify-content-between mt-2">
                <span class="text-muted">Amortização Parcial:</span>
                <span
                  id="resumo-amortizacao-parcial-detalhe"
                  class="fw-bold text-info"
                  >Nenhuma</span
                >
              </div>
              <div class="d-flex justify-content-between mt-2">
                <span class="text-muted">Economia de Juros (estimado):</span>
                <span id="resumo-economia-juros" class="fw-bold text-success"
                  >R$ 0,00</span
                >
              </div>
            </div>

            <div id="resumo-parcela" style="display: none">
              <div class="d-flex justify-content-between mt-2">
                <span class="text-muted">Parcelas Afetadas:</span>
                <span id="resumo-parcelas-afetadas" class="fw-bold text-info"
                  >0</span
                >
              </div>
              <div class="d-flex justify-content-between mt-2">
                <span class="text-muted">Redução por Parcela:</span>
                <span id="resumo-reducao-parcela" class="fw-bold text-info"
                  >R$ 0,00</span
                >
              </div>
            </div>
          </div>

          <hr class="my-2" />

          <h6
            class="caixa-sombreada"
          >
            4. Ação
          </h6>

          <div class="d-flex justify-content-center gap-2">
            <button type="submit" class="btn btn-azul">
              <i class="fas fa-hand-holding-usd text-warning me-1"></i> {{
              form.submit.label.text }}
            </button>
            <a
              href="{{ url_for('financiamento.listar_financiamentos') }}"
              class="btn btn-cinza"
            >
              <i class="fas fa-arrow-left text-warning me-1"></i> Voltar
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>
{% endblock %} {% block scripts %}
<script id="parcelas-prazo-data" type="application/json">
  {{ parcelas_json_prazo | tojson | safe }}
</script>
<script id="parcelas-parcela-data" type="application/json">
  {{ parcelas_json_parcela | tojson | safe }}
</script>

<script>
  const parcelasPrazo = JSON.parse(
    document.getElementById("parcelas-prazo-data").textContent
  );
  const parcelasParcela = JSON.parse(
    document.getElementById("parcelas-parcela-data").textContent
  );
</script>

<script src="{{ url_for('static', filename='js/financiamento.js') }}"></script>
{% endblock %}
