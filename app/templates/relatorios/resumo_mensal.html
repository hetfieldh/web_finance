<!--- app\templates\relatorios\resumo_mensal.html -->

{% extends "base.html" %} {% from "includes/_macros.html" import render_field %}
{% block content %}
<div class="row">
  <div class="col-12">
    <div class="caixa-sombreada mb-2">
      <span class="text-dark fw-bold">Resumo do Mês:</span>
      <span class="text-danger small d-block d-md-inline">
        Visão consolidada para verificar necessidade de aporte.
      </span>
    </div>

    <div class="card shadow-sm mb-2">
      <div class="card-body py-2">
        <form
          id="form-resumo-mensal"
          method="GET"
          action="{{ url_for('relatorios.resumo_mensal') }}"
        >
          <div class="row align-items-center">
            <div class="col-6 col-md-3 col-lg-2">
              <div class="input-group">
                <span class="input-group-text"
                  ><i class="fas fa-calendar-alt"></i
                ></span>
                {{ form.mes_ano(class="form-control fw-semibold text-danger",
                id="mes_ano_resumo") }}
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>

    <div class="row g-2 mb-2">
      <div class="col-6 col-lg-3">
        <div class="card h-100 shadow-sm border">
          <div class="card-body text-center p-2">
            <h6
              class="card-title text-muted extra-small fw-bold text-uppercase mb-1"
            >
              Saldo Operacional
              <!-- RÓTULO CORRIGIDO -->
            </h6>
            <p
              class="card-text h5 fw-semibold {% if dados.saldo_inicial >= 0 %}text-info{% else %}text-danger{% endif %} mb-0"
            >
              {{ dados.saldo_inicial | format_number }}
            </p>
          </div>
        </div>
      </div>

      <div class="col-6 col-lg-3">
        <div class="card h-100 shadow-sm border">
          <div class="card-body text-center p-2">
            <h6
              class="card-title text-muted extra-small fw-bold text-uppercase mb-1"
            >
              Receitas
            </h6>
            <p class="card-text h5 fw-semibold text-success mb-0">
              {{ dados.total_receitas | format_number }}
            </p>
          </div>
        </div>
      </div>

      <div class="col-6 col-lg-3">
        <div class="card h-100 shadow-sm border">
          <div class="card-body text-center p-2">
            <h6
              class="card-title text-muted extra-small fw-bold text-uppercase mb-1"
            >
              Despesas
            </h6>
            <p class="card-text h5 fw-semibold text-danger mb-0">
              {{ dados.total_despesas | format_number }}
            </p>
          </div>
        </div>
      </div>

      <div class="col-6 col-lg-3">
        <div
          class="card h-100 shadow-sm border-2 {% if dados.saldo_final_previsto >= 0 %}border-success bg-success-subtle{% else %}border-danger bg-danger-subtle{% endif %}"
        >
          <div class="card-body text-center p-2">
            <h6
              class="card-title text-dark extra-small fw-bold text-uppercase mb-1"
            >
              Saldo Final
            </h6>
            <p
              class="card-text h5 fw-bold {% if dados.saldo_final_previsto >= 0 %}text-success{% else %}text-danger{% endif %} mb-0"
            >
              {{ dados.saldo_final_previsto | format_number }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="card shadow-sm">
      <div class="card-header menu-primario py-2">
        <h5 class="mb-0 text-white h6">
          <i class="fas fa-list-ul me-2"></i>Movimentações Previstas/Realizadas
        </h5>
      </div>

      <div class="card-body p-0 p-md-3">
        <div class="table-responsive d-none d-md-block p-0">
          <table class="table table-striped table-hover sortable-table mb-0">
            <thead>
              <tr>
                <th>Vencimento</th>
                <th>Descrição</th>
                <th class="text-center">Tipo</th>
                <th class="text-center">Status</th>
                <th class="text-end">Valor</th>
              </tr>
            </thead>
            <tbody>
              {% for item in dados.movimentacoes %}
              <tr>
                <td>
                  <span style="display: none"
                    >{{ item.data.strftime('%Y%m%d') }}</span
                  >
                  {{ item.data.strftime('%d/%m/%Y') }}
                </td>
                <td>{{ item.descricao }}</td>
                <td class="text-center">{{ item.tipo }}</td>
                <td class="text-center">
                  {% if item.status in ['Pago', 'Recebido'] %}
                  <span class="badge bg-success-subtle text-success-emphasis"
                    >{{ item.status }}</span
                  >
                  {% else %}
                  <span class="badge bg-danger-subtle text-danger-emphasis"
                    >{{ item.status }}</span
                  >
                  {% endif %}
                </td>
                <td
                  class="text-end fw-semibold {% if item.tipo == 'Receita' %}text-success{% else %}text-danger{% endif %}"
                >
                  {{ item.valor | format_number }}
                </td>
              </tr>
              {% else %}
              <tr>
                <td colspan="5" class="text-center text-muted py-4">
                  Nenhuma movimentação encontrada.
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="d-md-none">
          {% if dados.movimentacoes %}
          <ul class="list-group list-group-flush">
            {% for item in dados.movimentacoes %} {% set is_receita = item.tipo
            == 'Receita' %} {% set is_pago = item.status in ['Pago', 'Recebido']
            %}

            <li
              class="list-group-item p-1 border-start border-1 {% if is_receita %}border-grey{% else %}border-grey{% endif %}"
            >
              <div
                class="d-flex justify-content-between align-items-start mb-1"
              >
                <span
                  class="fw-bold text-dark text-truncate me-2"
                  style="max-width: 65%"
                >
                  {{ item.descricao }}
                </span>
                <span
                  class="fw-bold text-nowrap {% if is_receita %}text-success{% else %}text-danger{% endif %}"
                >
                  {{ item.valor | format_number }}
                </span>
              </div>

              <div class="d-flex justify-content-between align-items-end">
                <div class="small text-muted">
                  <i class="far fa-calendar-alt me-1"></i>{{
                  item.data.strftime('%d/%m') }}
                  <span class="mx-1">•</span>
                  <span
                    class="badge border {% if is_pago %}bg-light text-success border-success{% else %}bg-light text-danger border-danger{% endif %} extra-small"
                  >
                    {{ item.status }}
                  </span>
                </div>
              </div>
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <div class="p-4 text-center text-muted">
            <i class="far fa-folder-open fa-2x mb-2 d-block opacity-50"></i>
            Nenhuma movimentação para este mês.
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script src="{{ url_for('static', filename='js/extratos.js') }}"></script>
{% endblock %}
