<!-- app\templates\relatorios\resumo_folha.html -->

{% extends "base.html" %} {% block content %}
<div class="row">
  <div class="col-12">
    <div class="caixa-sombreada mb-2">
      <span class="text-dark fw-bold">Resumo da Folha:</span>
      <span class="text-danger"
        >Visão anual consolidada dos salários, exibidos mês a mês.</span
      >
    </div>

    <div class="card shadow-sm mb-2">
      <div class="card-body py-2">
        <form
          id="form-resumo-folha"
          method="GET"
          action="{{ url_for('relatorios.resumo_folha') }}"
        >
          <div class="row align-items-center">
            <div class="col-md-2" style="width: 150px">
              <div class="input-group">
                <span class="input-group-text"
                  ><i class="fas fa-calendar-alt"></i
                ></span>
                {{ form.ano(class="form-select fw-semibold text-danger",
                id="ano_resumo_folha") }}
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>

    {% if dados %}
    <div class="card border-0 bg-light my-2">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table
            class="table table-sm table-hover align-middle sortable-table mb-0"
            style="
              font-size: 0.68rem;
              line-height: 1.1;
              width: 100%;
              table-layout: fixed;
            "
          >
            <thead class="table-light text-center">
              <tr>
                <th class="text-start px-1 py-1">Verba</th>
                {% for mes in dados.meses %}
                <th class="px-1 py-1" style="min-width: 38px">
                  {{ '%02d'|format(mes) }}/{{ '%02d'|format(ano_selecionado %
                  100) }}
                </th>
                {% endfor %}
                <th class="px-1 py-1" style="min-width: 45px">Total</th>
              </tr>
            </thead>

            <tbody>
              {% macro render_section(data, title, bg_color, text_color,
              total_data) %} {% if data %}
              <tr class="table-group-divider">
                <td
                  colspan="14"
                  class="fw-semibold {{ bg_color }} px-0 py-0 ps-1"
                >
                  {{ title }}
                </td>
              </tr>
              {% for linha in data %}
              <tr>
                <td class="ps-2">{{ linha.nome }}</td>
                {% for valor in linha.valores_mes %}
                <td class="text-end {{ text_color }}">
                  {{ valor | format_number if valor != 0 else '-' }}
                </td>
                {% endfor %}
                <td class="text-end fw-semibold table-light">
                  {{ linha.total_anual | format_number }}
                </td>
              </tr>
              {% endfor %}
              <tr class="{{ bg_color }} fw-semibold">
                <td class="ps-1">{{ total_data.nome }}</td>
                {% for valor in total_data.valores_mes %}
                <td class="text-end">
                  {{ valor | format_number if valor != 0 else '-' }}
                </td>
                {% endfor %}
                <td class="text-end table-light">
                  {{ total_data.total_anual | format_number }}
                </td>
              </tr>
              {% endif %} {% endmacro %} {{
              render_section(dados.tabela.Provento, 'Proventos',
              'bg-success-subtle', 'text-success', dados.totais.proventos) }} {{
              render_section(dados.tabela.Benefício, 'Benefícios',
              'bg-primary-subtle', 'text-primary', dados.totais.beneficios) }}
              {{ render_section(dados.tabela.Desconto, 'Descontos',
              'bg-danger-subtle', 'text-danger', dados.totais.descontos) }} {{
              render_section(dados.tabela.Imposto, 'Impostos',
              'bg-warning-subtle', 'text-warning', dados.totais.impostos) }}

              <tr class="table-info fw-semibold table-group-divider">
                <td class="ps-1">{{ dados.salario_liquido.nome }}</td>
                {% for valor in dados.salario_liquido.valores_mes %}
                <td class="text-end">{{ valor | format_number }}</td>
                {% endfor %}
                <td class="text-end table-group-driver fw-bold">
                  {{ dados.salario_liquido.total_anual | format_number }}
                </td>
              </tr>

              {% if dados.tabela.FGTS %}
              <tr class="table-group-divider">
                <td
                  colspan="14"
                  class="fw-semibold bg-secondary-subtle px-0 py-0 ps-1"
                >
                  FGTS
                </td>
              </tr>
              {% for linha in dados.tabela.FGTS %}
              <tr>
                <td class="ps-2">{{ linha.nome }}</td>
                {% for valor in linha.valores_mes %}
                <td class="text-end text-muted">
                  {{ valor | format_number if valor != 0 else '-' }}
                </td>
                {% endfor %}
                <td class="text-end fw-semibold table-light">
                  {{ linha.total_anual | format_number }}
                </td>
              </tr>
              {% endfor %} {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    {% else %}
    <div class="alert alert-info text-center mt-3">
      Nenhum dado de folha de pagamento encontrado para o ano selecionado.
    </div>
    {% endif %}
  </div>
</div>
{% endblock %} {% block scripts %}
<script src="{{ url_for('static', filename='js/extratos.js') }}"></script>
{% endblock %}
