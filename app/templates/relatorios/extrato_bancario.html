<!--- app\templates\relatorios\extrato_bancario.html -->

{% extends "base.html" %} {% from "includes/_macros.html" import render_field %}
{% block content %}
  <div class="row">
    <div class="col-12">
      <div class="caixa-sombreada mb-1">
        <span class="text-dark fw-bold">Extrato Bancário:</span>
        <span class="text-danger">Movimentações da conta no mês.</span>
      </div>

      <div class="card border-0 bg-transparent mb-1">
        <div class="card-body py-2">
          <form id="form-extrato-bancario" method="GET" action="{{ url_for('extrato.extrato_bancario') }}">
            <div class="row align-items-center">
              <div class="col-md-4 mb-2 mb-md-0 p-0 m-0">
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-university"></i></span>
                  {{ form.conta_id(class="form-select", id="conta_id") }}
                </div>
              </div>
              <div class="col-md-2 col-6">
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                  {{
                    form.mes_ano(class="form-control fw-semibold text-danger",
                    id="mes_ano_extratos")
                  }}
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>

      {% if conta_selecionada %}
        <div class="card shadow-sm mb-2">
          <div class="card-body">
            <div class="row text-center align-items-center">
              <div class="col-6 col-lg">
                <h6 class="text-muted mb-0">Saldo Anterior</h6>
                <p class="h5 mb-1">{{ saldo_anterior | format_number }}</p>
              </div>
              <div class="col-6 col-lg">
                <h6 class="text-muted mb-0">Créditos</h6>
                <p class="h5 text-success mb-1">{{ total_creditos | format_number }}</p>
              </div>
              <div class="col-6 col-lg">
                <h6 class="text-muted mb-0">Débitos</h6>
                <p class="h5 text-danger mb-1">{{ total_debitos | format_number }}</p>
              </div>
              <div class="col-6 col-lg">
                <h6 class="text-muted mb-0">Limite Disp.</h6>
                <p class="h5 mb-1">{{ (limite_conta if limite_conta else 0) | format_number }}</p>
              </div>
              <div class="col-12 col-lg-auto mt-1 mt-lg-0">
                <div
                  class="card {% if saldo_final_mes >= 0 %}
                    bg-success-subtle border-success
                  {% else %}
                    bg-danger-subtle border-danger
                  {% endif %}"
                >
                  <div class="card-body p-1 px-4">
                    <h6 class="card-title mb-0 text-center">Saldo Final</h6>
                    <p class="card-text h5 fw-bold mb-0 text-center">{{ saldo_final_mes | format_number }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card shadow-sm">
          <div class="card-header menu-primario">
            <h6 class="mb-0 text-white">
              <i class="fas fa-list-ul text-warning me-2"></i>
              {{ conta_selecionada.nome_banco }} ({{ conta_selecionada.tipo }})
            </h6>
          </div>

          <div class="card-body p-0">
            {% if movimentacoes %}
              <div class="table-responsive d-none d-lg-block">
                <table class="table table-striped table-hover sortable-table">
                  <thead>
                    <tr>
                      <th>Data</th>
                      <th>Tipo Transação</th>
                      <th>Movimento</th>
                      <th class="text-end">Valor</th>
                      <th>Descrição</th>
                      <th class="text-end">Saldo Acumulado</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for mov in movimentacoes %}
                      <tr>
                        <td>
                          <span style="display: none">{{ mov.data_movimento.strftime('%Y%m%d') }}</span>
                          {{ mov.data_movimento.strftime('%d/%m/%Y') }}
                        </td>
                        <td>{{ mov.tipo_transacao_nome }}</td>
                        <td>
                          {% if mov.tipo_movimento == 'Crédito' %}
                            <span class="badge bg-success-subtle text-success-emphasis">Crédito</span>
                          {% elif mov.tipo_movimento == 'Débito' %}
                            <span class="badge bg-danger-subtle text-danger-emphasis">Débito</span>
                          {% else %}
                            {{ mov.tipo_movimento }}
                          {% endif %}
                        </td>
                        <td
                          class="text-end {% if mov.tipo_movimento == 'Débito' %}
                            text-danger fw-semibold
                          {% else %}
                            text-success fw-semibold
                          {% endif %}"
                        >
                          {% if mov.tipo_movimento == 'Débito' %}
                            -
                          {% else %}
                            +
                          {% endif %}{{ mov.valor | format_number }}
                        </td>
                        <td>{{ mov.descricao if mov.descricao else '-' }}</td>
                        <td class="text-end fw-bold {% if mov.saldo_acumulado < 0 %}text-danger{% endif %}">
                          {{ mov.saldo_acumulado | format_number }}
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>

              <div class="d-lg-none">
                <div class="list-group list-group-flush">
                  {% for mov in movimentacoes %}
                    <div
                      class="list-group-item p-1 border-start border-1 {% if mov.tipo_movimento == 'Débito' %}border-grey{% else %}border-grey{% endif %}"
                    >
                      <div class="d-flex justify-content-between align-items-start mb-1">
                        <span class="fw-bold text-dark text-truncate me-2" style="max-width: 65%">
                          {{ mov.descricao if mov.descricao else mov.tipo_transacao_nome }}
                        </span>
                        <span
                          class="fw-bold text-nowrap {% if mov.tipo_movimento == 'Débito' %}text-danger{% else %}text-success{% endif %}"
                        >
                          {% if mov.tipo_movimento == 'Débito' %}-{% endif %}{{ mov.valor | format_number }}
                        </span>
                      </div>

                      <div class="d-flex justify-content-between align-items-end">
                        <div class="small text-muted">
                          <i class="far fa-calendar-alt me-1"></i>
                          {{ mov.data_movimento.strftime('%d/%m') }}
                          <span class="mx-1">•</span>
                          <span class="badge bg-light text-secondary border">{{ mov.tipo_transacao_nome }}</span>
                        </div>
                        <div class="small">
                          <span class="text-muted extra-small me-1">Saldo:</span>
                          <span
                            class="fw-bold {% if mov.saldo_acumulado < 0 %}text-danger{% else %}text-dark{% endif %}"
                          >
                            {{ mov.saldo_acumulado | format_number }}
                          </span>
                        </div>
                      </div>
                    </div>
                  {% endfor %}
                </div>
              </div>
            {% else %}
              <div class="p-4 text-center">
                <p class="alert alert-info mb-0">
                  <i class="fas fa-info-circle me-2"></i>
                  Nenhuma movimentação encontrada para este período.
                </p>
              </div>
            {% endif %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>
{% endblock %}
{% block scripts %}
  <script src="{{ url_for('static', filename='js/extratos.js') }}"></script>
{% endblock %}
