<!-- app\templates\alertas\contas_a_vencer.html -->

{% extends "base.html" %} {% block content %}

<div
  class="caixa-sombreada-cinza p-2 d-flex justify-content-between align-items-center mb-2 shadow-sm"
>
  <h5 class="mb-0">
    <i class="fas fa-bell text-danger me-2"></i>Contas a Vencer nos Próximos 7
    Dias
  </h5>
</div>

<div>
  <div>
    <div class="table-responsive d-none d-lg-block px-0">
      <div class="card shadow-sm">
        <div class="card-body py-0 px-1">
          <table class="table table-striped table-hover sortable-table">
            <thead>
              <tr>
                <th>Vencimento</th>
                <th>Descrição</th>
                <th class="text-end">Valor Previsto</th>
                <th class="text-center">Tipo</th>
                <th class="text-center">Ações</th>
              </tr>
            </thead>
            <tbody>
              {% for item in movimentos %}
              <tr>
                <td>
                  <span style="display: none">
                    {{ item.data.strftime('%Y%m%d') }}
                  </span>
                  {{ item.data.strftime('%d/%m/%Y') }}
                </td>
                <td>{{ item.descricao }}</td>
                <td class="text-end">{{ item.valor | format_number }}</td>
                <td class="text-center">
                  {% if item.natureza == 'Despesa' %}
                  <span class="badge bg-danger-subtle text-danger-emphasis"
                    >A Pagar</span
                  >
                  {% else %}
                  <span class="badge bg-success-subtle text-success-emphasis"
                    >A Receber</span
                  >
                  {% endif %}
                </td>
                <td class="text-center">
                  {% if item.natureza == 'Despesa' %} {% if item.tipo_item ==
                  'Crediário' and item.desatualizada %}

                  <div
                    class="d-flex justify-content-center align-items-center"
                    style="min-height: 12px"
                  >
                    <i
                      class="fas fa-sync-alt fa-lg text-primary"
                      data-bs-toggle="tooltip"
                      title="Fatura desatualizada! Sincronize as faturas na tela de 'Faturas de Crediário' antes de pagar."
                    ></i>
                  </div>

                  {% else %}
                  <button
                    type="button"
                    class="btn btn-link text-danger p-0"
                    data-bs-toggle="modal"
                    data-bs-target="#pagamentoModal"
                    data-item-id="{{ item.id_original }}"
                    data-item-tipo="{{ item.tipo_item }}"
                    data-item-valor="{{ item.valor_para_modal }}"
                    data-item-descricao="{{ item.descricao }}"
                    title="Registrar Pagamento"
                  >
                    <i class="fas fa-hand-holding-usd fa-sm"></i>
                  </button>
                  {% endif %} {% else %}
                  <button
                    type="button"
                    class="btn btn-link text-success p-0"
                    data-bs-toggle="modal"
                    data-bs-target="#recebimentoModal"
                    data-item-id="{{ item.id_original }}"
                    data-item-tipo="{{ item.tipo_item }}"
                    data-item-valor="{{ item.valor_para_modal }}"
                    data-item-descricao="{{ item.descricao }}"
                    data-conta-sugerida-id="{{ item.conta_sugerida_id or '' }}"
                    data-folha-tem-fgts="{{ 'true' if item.folha_tem_fgts else 'false' }}"
                    title="Registrar Recebimento"
                  >
                    <i class="fas fa-hand-holding-usd fa-sm"></i>
                  </button>
                  {% endif %}
                </td>
              </tr>
              {% else %}
              <tr>
                <td colspan="5" class="text-center">
                  Nenhuma conta a vencer nos próximos 7 dias.
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="d-lg-none">
      {% for item in movimentos %}
      <div class="card mb-1 shadow-sm border">
        <div class="card-body p-2">
          <div class="d-flex justify-content-between align-items-start mb-1">
            <h6 class="card-title fw-bold mb-0" style="max-width: 80%">
              {{ item.descricao }}
            </h6>
            {% if item.natureza == 'Despesa' %}
            <span class="badge bg-danger-subtle text-danger-emphasis"
              >A Pagar</span
            >
            {% else %}
            <span class="badge bg-success-subtle text-success-emphasis"
              >A Receber</span
            >
            {% endif %}
          </div>

          <div class="d-flex justify-content-between align-items-baseline mb-2">
            <span
              class="h5 mb-0 {% if item.natureza == 'Despesa' %}text-danger{% else %}text-success{% endif %}"
            >
              {{ item.valor | format_number }}
            </span>
            <small class="text-muted fw-bold">
              Vence: {{ item.data.strftime('%d/%m/%Y') }}
            </small>
          </div>

          <div class="text-center">
            {% if item.natureza == 'Despesa' %} {% if item.tipo_item ==
            'Crediário' and item.desatualizada %}
            <div class="alert alert-primary py-1 px-2 small text-center mb-0">
              <i class="fas fa-sync-alt me-1"></i>
              Fatura desatualizada. Sincronize na tela de Faturas.
            </div>
            {% else %}
            <button
              type="button"
              class="btn btn-danger btn-sm w-100"
              data-bs-toggle="modal"
              data-bs-target="#pagamentoModal"
              data-item-id="{{ item.id_original }}"
              data-item-tipo="{{ item.tipo_item }}"
              data-item-valor="{{ item.valor_para_modal }}"
              data-item-descricao="{{ item.descricao }}"
            >
              <i class="fas fa-hand-holding-usd me-2"></i>Registrar Pagamento
            </button>
            {% endif %} {% else %}
            <button
              type="button"
              class="btn btn-success btn-sm w-100"
              data-bs-toggle="modal"
              data-bs-target="#recebimentoModal"
              data-item-id="{{ item.id_original }}"
              data-item-tipo="{{ item.tipo_item }}"
              data-item-valor="{{ item.valor_para_modal }}"
              data-item-descricao="{{ item.descricao }}"
              data-conta-sugerida-id="{{ item.conta_sugerida_id or '' }}"
              data-folha-tem-fgts="{{ 'true' if item.folha_tem_fgts else 'false' }}"
            >
              <i class="fas fa-hand-holding-usd me-2"></i>Registrar Recebimento
            </button>
            {% endif %}
          </div>
        </div>
      </div>
      {% else %}
      <div class="text-center p-3">
        <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
        <p class="text-muted mb-0">
          Nenhuma conta a vencer nos próximos 7 dias.
        </p>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
{% include 'includes/_modal_pagamento.html' %} {% include
'includes/_modal_recebimento.html' %} {% endblock %} {% block scripts %} {{
super() }}

<script type="application/json" id="contas-data">
  {{ contas_json | tojson }}
</script>
<script type="application/json" id="fgts-info-data">
  {{ fgts_info | tojson }}
</script>

<script src="{{ url_for('static', filename='js/modals.js') }}"></script>
<script src="{{ url_for('static', filename='js/pagamentos.js') }}"></script>
<script src="{{ url_for('static', filename='js/recebimentos.js') }}"></script>

{% endblock %}
