<!--- app\templates\dashboard.html -->

{% extends 'base.html' %} {% from "includes/_macros.html" import render_field %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-2">
  <div>
    <h4 class="text-secondary mb-0">
      Bem-vindo(a),
      <span class="text-dark fw-semibold"
        >{{ current_user.nome or current_user.login }}!</span
      >
    </h4>
    <p id="data-atual" class="text-muted small mb-0"></p>
  </div>
  <div class="d-flex align-items-center">
    {% if contas_vencidas_count > 0 %}
    <a
      href="{{ url_for('main.contas_vencidas') }}"
      class="btn btn-lg btn-transparent text-danger me-2"
      title="{{ contas_vencidas_count }} conta(s) vencida(s)"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
    >
      <span class="position-relative">
        <i class="fas fa-exclamation-triangle fa-2x"></i>
        <span
          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
        >
          {{ contas_vencidas_count }}
          <span class="visually-hidden">contas vencidas</span>
        </span>
      </span>
    </a>
    {% endif %} {% if contas_a_vencer_count > 0 %}
    <a
      href="{{ url_for('main.contas_a_vencer') }}"
      class="btn btn-lg btn-transparent text-warning me-2"
      title="{{ contas_a_vencer_count }} conta(s) a vencer nos próximos 7 dias"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
    >
      <span class="position-relative">
        <i class="fas fa-hand-holding-usd fa-2x"></i>
        <span
          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
        >
          {{ contas_a_vencer_count }}
          <span class="visually-hidden">contas a vencer</span>
        </span>
      </span>
    </a>
    {% endif %} {% if current_user.is_admin and pending_requests > 0 %}
    <a
      href="{{ url_for('solicitacao.gerenciar_solicitacoes') }}"
      class="btn btn-lg btn-transparent text-info me-2"
      title="{{ pending_requests }} nova(s) solicitação(ões)"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
    >
      <span class="position-relative">
        <i class="fas fa-user-plus fa-2x"></i>
        <span
          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
        >
          {{ pending_requests }}
          <span class="visually-hidden">solicitações pendentes</span>
        </span>
      </span>
    </a>
    {% endif %}
  </div>
</div>

<div class="row g-2 mb-2">
  <div class="col">
    <div class="card conta-hover">
      <div class="card-body text-center py-1">
        <h6 class="card-title text-muted small">SALDO OPERACIONAL</h6>
        <p
          class="card-text h5 fw-semibold {% if kpis.saldo_operacional >= 0 %}text-success{% else %}text-danger{% endif %}"
        >
          {{ kpis.saldo_operacional | format_currency }}
        </p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card conta-hover">
      <div class="card-body text-center py-1">
        <h6 class="card-title text-muted small">INVESTIMENTOS</h6>
        <p class="card-text h5 fw-semibold text-success">
          {{ kpis.saldo_investimentos | format_currency }}
        </p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card conta-hover">
      <div class="card-body text-center py-1">
        <h6 class="card-title text-muted small">BENEFÍCIOS</h6>
        <p class="card-text h5 fw-semibold text-secondary">
          {{ kpis.saldo_beneficios | format_currency }}
        </p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card conta-hover">
      <div class="card-body text-center py-1">
        <h6 class="card-title text-muted small">FGTS</h6>
        <p class="card-text h5 fw-semibold text-secondary">
          {{ kpis.saldo_fgts | format_currency }}
        </p>
      </div>
    </div>
  </div>
</div>

<div class="row g-2 mb-2">
  <div class="col">
    <div class="card conta-hover">
      <div class="card-body text-center py-1">
        <h6 class="card-title text-muted small">
          RECEITAS DO MÊS
          <span
            style="
              font-size: 0.7em;
              margin-left: 1px;
              color: var(--wf-info);
              font-style: italic;
            "
          >
            (Exceto benefícios)
          </span>
        </h6>
        <p class="card-text h5 fw-semibold text-success">
          {{ kpis.receitas_mes | format_currency }}
        </p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card conta-hover">
      <div class="card-body text-center py-1">
        <h6 class="card-title text-muted small">DESPESAS DO MÊS</h6>
        <p class="card-text h5 fw-semibold text-danger">
          {{ kpis.despesas_mes | format_currency }}
        </p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card conta-hover">
      <div class="card-body text-center py-1">
        <h6 class="card-title text-muted small align-items-center">
          SALDO
          <span
            style="
              font-size: 0.7em;
              margin-left: 1px;
              color: var(--wf-info);
              font-style: italic;
            "
          >
            (Receitas - Despesas)
          </span>
        </h6>
        <p
          class="card-text h5 fw-semibold {% if kpis.balanco_mes >= 0 %}text-success{% else %}text-danger{% endif %}"
        >
          {{ kpis.balanco_mes | format_currency }}
        </p>
      </div>
    </div>
  </div>
</div>

<div class="row g-2">
  <div class="col-lg-3">
    <div class="card shadow-sm">
      <div class="card-header bg-light">
        <h6 class="fw-semibold mb-0 text-secondary">
          Contas Bancárias
          <span
            style="
              font-size: 0.6em;
              margin-left: 1px;
              color: var(--wf-info);
              font-style: italic;
            "
          >
            (Apenas contas ativas)
          </span>
        </h6>
      </div>
      <div class="card-body p-1" style="overflow-y: auto; max-height: 500px">
        {% if contas_do_usuario %}
        <div class="d-flex flex-column gap-1">
          {% for conta in contas_do_usuario %}
          <div class="card conta-hover">
            <div
              class="card-body p-1 d-flex justify-content-between align-items-center"
            >
              <div class="d-flex align-items-center">
                <i
                  class="fas fa-wallet fa-lg text-secondary opacity-50 me-2"
                ></i>
                <div>
                  <div class="fw-semibold extra-small">
                    {{ conta.nome_banco }}
                  </div>
                  <div class="text-muted extra-small">{{ conta.tipo }}</div>
                </div>
              </div>
              <span
                class="fw-semibold h6 mb-0 {% if conta.saldo_atual >= 0 %}text-success{% else %}text-danger{% endif %}"
                >{{ conta.saldo_atual | format_currency }}</span
              >
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="text-center p-2">
          <p class="text-muted small mb-0">
            Nenhuma conta bancária cadastrada.
          </p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-3">
    <div class="card shadow-sm">
      <div class="card-header bg-light">
        <h6 class="fw-semibold mb-0 text-secondary">
          Últimas Movimentações Bancárias
        </h6>
      </div>
      <div class="card-body p-0" style="overflow-y: auto; max-height: 500px">
        {% if ultimos_movimentos %}
        <ul class="list-group list-group-flush itens-lista">
          {% for mov in ultimos_movimentos %}
          <li
            class="list-group-item py-1 d-flex justify-content-between align-items-center small"
          >
            <div>
              {% set title_text = mov.tipo_transacao.transacao_tipo ~ ' | ' ~
              mov.conta.nome_banco or mov.descricao or 'N/A' %}
              <div
                class="fw-semibold text-dark extra-small-2"
                title="{{ title_text }}"
              >
                {{ title_text | truncate(35) }}
              </div>
              <div class="text-muted extra-small-3">
                <i class="fas fa-calendar-alt me-1"></i>{{
                mov.data_movimento.strftime('%d/%m') }}
                <i class="fas fa-university ms-2 me-1"></i>{{
                mov.conta.nome_banco | truncate(10) }}
              </div>
            </div>
            {% if mov.tipo_transacao.tipo == 'Débito' %}
            <span
              class="badge rounded-pill bg-danger-subtle text-danger-emphasis"
            >
              {{ mov.valor | format_currency }}
            </span>
            {% else %}
            <span
              class="badge rounded-pill bg-success-subtle text-success-emphasis"
            >
              {{ mov.valor | format_currency }}
            </span>
            {% endif %}
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <div class="text-center p-3">
          <i class="fas fa-info-circle fa-2x text-muted mb-1"></i>
          <p class="text-muted small mb-0">
            Nenhuma movimentação bancária encontrada.
          </p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-3">
    <div class="card shadow-sm">
      <div class="card-header bg-light">
        <form
          id="form-movimentos-mes"
          method="GET"
          class="d-flex align-items-center justify-content-between"
        >
          <h6 class="fw-semibold mb-0 text-secondary">
            Próximos Vencimentos em:
          </h6>
          {{ form_movimentos.mes_ano(class="form-control form-control-xs
          input-compacto", id="mes_ano_dashboard") }}
        </form>
      </div>
      <div class="card-body p-0" style="overflow-y: auto; max-height: 500px">
        {% if proximos_movimentos %}
        <ul class="list-group list-group-flush itens-lista">
          {% for item in proximos_movimentos %}
          <li
            class="list-group-item py-1 d-flex justify-content-between align-items-center small"
          >
            <div>
              <div
                class="fw-semibold text-dark extra-small-2"
                title="{{ item.descricao }}"
              >
                {{ item.descricao | truncate(25) }}
              </div>
              <div class="text-muted extra-small-3">
                {{ item.data.strftime('%d/%m/%Y') }}
              </div>
            </div>
            {% if item.tipo == 'Saída' %}
            <span
              class="badge bg-danger-subtle text-danger-emphasis rounded-pill"
              >{{ item.valor | format_currency }}</span
            >
            {% else %}
            <span
              class="badge bg-success-subtle text-success-emphasis rounded-pill"
              >{{ item.valor | format_currency }}</span
            >
            {% endif %}
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <div class="text-center p-3">
          <i class="fas fa-check-circle fa-2x text-success mb-1"></i>
          <p class="text-muted small mb-0">
            Não há nada em aberto para este mês.
          </p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-3">
    <div class="card shadow-sm">
      <div class="card-header bg-light">
        <h6 class="fw-semibold mb-0 text-secondary">
          Saldos Devedores
          <span
            style="
              font-size: 0.6em;
              margin-left: 1px;
              color: var(--wf-info);
              font-style: italic;
            "
          >
            (Apenas com saldo devedor)
          </span>
        </h6>
      </div>
      <div class="card-body p-1" style="overflow-y: auto; max-height: 500px">
        <div class="d-flex flex-column gap-1">
          {% if financiamentos %} {% for financ in financiamentos %} {% if
          financ.saldo_devedor_atual > 0 %}
          <div class="card conta-hover">
            <div
              class="card-body p-1 d-flex justify-content-between align-items-center"
            >
              <div class="d-flex align-items-center">
                <i
                  class="fas fa-file-invoice-dollar fa-lg text-secondary opacity-50 me-2"
                ></i>
                <div>
                  <div class="fw-semibold extra-small">
                    {{ financ.nome_financiamento }}
                  </div>
                  <div class="text-muted extra-small">Financiamento</div>
                </div>
              </div>
              <span class="fw-semibold h6 mb-0 text-danger"
                >{{ financ.saldo_devedor_atual | format_currency }}</span
              >
            </div>
          </div>
          {% endif %} {% endfor %} {% endif %} {% if crediarios %} {% for cred
          in crediarios %} {% if cred.saldo_devedor > 0 %}
          <div class="card conta-hover">
            <div
              class="card-body p-1 d-flex justify-content-between align-items-center"
            >
              <div class="d-flex align-items-center">
                <i
                  class="fas fa-credit-card fa-lg text-secondary opacity-50 me-2"
                ></i>
                <div>
                  <div class="fw-semibold extra-small">
                    {{ cred.nome_crediario }}
                  </div>
                  <div class="text-muted extra-small">Crediário</div>
                </div>
              </div>
              <span class="fw-semibold h6 mb-0 text-danger"
                >{{ cred.saldo_devedor | format_currency }}</span
              >
            </div>
          </div>
          {% endif %} {% endfor %} {% endif %} {% if not financiamentos and not
          crediarios%}
          <div class="text-center p-2">
            <p class="text-muted extra-small mb-0">
              Nenhum saldo devedor encontrado.
            </p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
