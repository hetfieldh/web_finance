<!--- app\templates\dashboard.html -->

{% extends 'base.html' %} {% from "includes/_macros.html" import render_field %}
{% block title %}Web Finance - Dashboard{% endblock %} {% block page_title
%}Dashboard{% endblock %} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-2">
  <div>
    <h4 class="text-secondary mb-0">
      Bem-vindo(a),
      <span class="text-dark fw-semibold"
        >{{ current_user.nome or current_user.login }}!</span
      >
    </h4>
    <p id="data-atual" class="text-muted small mb-0"></p>
  </div>
  <div class="d-flex align-items-center">
    {% if current_user.is_admin and pending_requests > 0 %}
    <a
      href="{{ url_for('solicitacao.gerenciar_solicitacoes') }}"
      class="btn btn-lg btn-transparent text-warning me-2"
      title="{{ pending_requests }} nova(s) solicitação(ões)"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
    >
      <span class="position-relative">
        <i class="fas fa-user-plus fa-2x"></i>
        <span
          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
        >
          {{ pending_requests }}
          <span class="visually-hidden">solicitações pendentes</span>
        </span>
      </span>
    </a>
    {% endif %}
    <a
      href="{{ url_for('graphics.resumo_financiamentos') }}"
      class="btn btn-lg btn-transparent text-secondary"
      title="Ver Resumo de Financiamentos"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
    >
      <i class="fas fa-poll fa-2x"></i>
    </a>
    <a
      href="{{ url_for('graphics.view_graphics') }}"
      class="btn btn-lg btn-transparent text-secondary"
      title="Ver Análises Gráficas Mensais"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
    >
      <i class="fas fa-chart-pie fa-2x"></i>
    </a>
  </div>
</div>

<div class="row g-2 mb-2">
  <div class="col">
    <div class="card shadow-sm h-100 bg-light">
      <div class="card-body text-center py-1">
        <h6 class="card-title text-muted small">SALDO OPERACIONAL</h6>
        <p
          class="card-text h5 fw-semibold {% if kpis.saldo_operacional >= 0 %}text-success{% else %}text-danger{% endif %}"
        >
          {{ kpis.saldo_operacional | format_currency }}
        </p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card shadow-sm h-100 bg-light">
      <div class="card-body text-center py-1">
        <h6 class="card-title text-muted small">INVESTIMENTOS</h6>
        <p class="card-text h5 fw-semibold text-primary">
          {{ kpis.saldo_investimentos | format_currency }}
        </p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card shadow-sm h-100 bg-light">
      <div class="card-body text-center py-1">
        <h6 class="card-title text-muted small">BENEFÍCIOS</h6>
        <p class="card-text h5 fw-semibold text-info">
          {{ kpis.saldo_beneficios | format_currency }}
        </p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card shadow-sm h-100 bg-light">
      <div class="card-body text-center py-1">
        <h6 class="card-title text-muted small">FGTS</h6>
        <p class="card-text h5 fw-semibold text-secondary">
          {{ kpis.saldo_fgts | format_currency }}
        </p>
      </div>
    </div>
  </div>
</div>

<div class="row g-2 mb-2">
  <div class="col">
    <div class="card shadow-sm h-100 bg-light">
      <div class="card-body text-center py-1">
        <h6 class="card-title text-muted small">RECEITAS DO MÊS</h6>
        <p class="card-text h5 fw-semibold text-success">
          {{ kpis.receitas_mes | format_currency }}
        </p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card shadow-sm h-100 bg-light">
      <div class="card-body text-center py-1">
        <h6 class="card-title text-muted small">DESPESAS DO MÊS</h6>
        <p class="card-text h5 fw-semibold text-danger">
          {{ kpis.despesas_mes | format_currency }}
        </p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card shadow-sm h-100 bg-light">
      <div class="card-body text-center py-1">
        <h6 class="card-title text-muted small">SALDO (Receitas - Despesas)</h6>
        <p
          class="card-text h5 fw-semibold {% if kpis.balanco_mes >= 0 %}text-success{% else %}text-danger{% endif %}"
        >
          {{ kpis.balanco_mes | format_currency }}
        </p>
      </div>
    </div>
  </div>
</div>

<div class="row g-2">
  <div class="col-lg-3">
    <div class="card shadow-sm">
      <div class="card-header bg-light">
        <h6 class="fw-semibold mb-0 text-secondary">Contas Bancárias Ativas</h6>
      </div>
      <div class="card-body p-1" style="overflow-y: auto; max-height: 500px">
        {% if contas_do_usuario %}
        <div class="d-flex flex-column gap-1">
          {% for conta in contas_do_usuario %}
          <div class="card border-1">
            <div
              class="card-body p-1 d-flex justify-content-between align-items-center"
            >
              <div class="d-flex align-items-center">
                <i
                  class="fas fa-wallet fa-lg text-secondary opacity-50 me-2"
                ></i>
                <div>
                  <div class="fw-semibold extra-small">
                    {{ conta.nome_banco }}
                  </div>
                  <div class="text-muted extra-small">{{ conta.tipo }}</div>
                </div>
              </div>
              <span
                class="fw-semibold h6 mb-0 {% if conta.saldo_atual >= 0 %}text-success{% else %}text-danger{% endif %}"
                >{{ conta.saldo_atual | format_currency }}</span
              >
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="text-center p-2">
          <p class="text-muted small mb-0">
            Nenhuma conta bancária cadastrada.
          </p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-lg-3">
    <div class="card shadow-sm">
      <div class="card-header bg-light">
        <form
          id="form-movimentos-mes"
          method="GET"
          class="d-flex align-items-center justify-content-between"
        >
          <h6 class="fw-semibold mb-0 text-secondary">
            Próximas Contas do mês:
          </h6>
          {{ form_movimentos.mes_ano(class="form-control form-control-xs
          input-compacto", id="mes_ano_dashboard") }}
        </form>
      </div>
      <div class="card-body p-0" style="overflow-y: auto; max-height: 500px">
        {% if proximos_movimentos %}
        <ul class="list-group list-group-flush">
          {% for item in proximos_movimentos %}
          <li
            class="list-group-item py-1 d-flex justify-content-between align-items-center small"
          >
            <div>
              <div
                class="fw-semibold text-dark extra-small-2"
                title="{{ item.descricao }}"
              >
                {{ item.descricao | truncate(25) }}
              </div>
              <div class="text-muted extra-small-3">
                {{ item.data.strftime('%d/%m/%Y') }}
              </div>
            </div>
            {% if item.tipo == 'saida' %}
            <span
              class="badge bg-danger-subtle text-danger-emphasis rounded-pill"
              >{{ item.valor | format_currency }}</span
            >
            {% else %}
            <span
              class="badge bg-success-subtle text-success-emphasis rounded-pill"
              >{{ item.valor | format_currency }}</span
            >
            {% endif %}
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <div class="text-center p-3">
          <i class="fas fa-check-circle fa-2x text-success mb-1"></i>
          <p class="text-muted small mb-0">
            Não há nada em aberto para este mês.
          </p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-lg-3">
    <div class="card shadow-sm">
      <div class="card-header bg-light">
        <h6 class="fw-semibold mb-0 text-secondary">Saldos Devedores</h6>
      </div>
      <div class="card-body p-1" style="overflow-y: auto; max-height: 500px">
        <div class="d-flex flex-column gap-1">
          {% if financiamentos %} {% for financ in financiamentos %}
          <div class="card border-1">
            <div
              class="card-body p-1 d-flex justify-content-between align-items-center"
            >
              <div class="d-flex align-items-center">
                <i
                  class="fas fa-file-invoice-dollar fa-lg text-secondary opacity-50 me-2"
                ></i>
                <div>
                  <div class="fw-semibold small">
                    {{ financ.nome_financiamento }}
                  </div>
                  <div class="text-muted extra-small">Financiamento</div>
                </div>
              </div>
              <span class="fw-semibold h5 mb-0 text-danger"
                >{{ financ.saldo_devedor_atual | format_currency }}</span
              >
            </div>
          </div>
          {% endfor %} {% endif %} {% if crediarios %} {% for cred in crediarios
          %}
          <div class="card border-1">
            <div
              class="card-body p-1 d-flex justify-content-between align-items-center"
            >
              <div class="d-flex align-items-center">
                <i
                  class="fas fa-credit-card fa-lg text-secondary opacity-50 me-2"
                ></i>
                <div>
                  <div class="fw-semibold small">{{ cred.nome_crediario }}</div>
                  <div class="text-muted extra-small">Crediário</div>
                </div>
              </div>
              <span class="fw-semibold h5 mb-0 text-danger"
                >{{ cred.saldo_devedor | format_currency }}</span
              >
            </div>
          </div>
          {% endfor %} {% endif %} {% if not financiamentos and not crediarios
          %}
          <div class="text-center p-2">
            <p class="text-muted small mb-0">
              Nenhum saldo devedor encontrado.
            </p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
